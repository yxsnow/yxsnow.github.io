import{_ as e,r as t,o as p,c as o,b as n,d as s,e as c,a as i}from"./app-ff2f634e.js";const l={},r=i(`<h2 id="æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ¦‚å¿µ" aria-hidden="true">#</a> æ¦‚å¿µ</h2><blockquote><p>IntersectionObserveræ¥å£(ä»å±äºIntersection Observer API)ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å¯ä»¥å¼‚æ­¥ç›‘å¬ç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆæˆ–è§†çª—(viewport)äº¤å‰çŠ¶æ€çš„æ‰‹æ®µã€‚ç¥–å…ˆå…ƒç´ ä¸è§†çª—(viewport)è¢«ç§°ä¸ºæ ¹(root)ã€‚</p></blockquote><p>è¿™æ˜¯MDNä¸Šç»™çš„å®˜æ–¹æ¦‚å¿µï¼Œä¸ç”¨å»ç®¡å®ƒï¼Œæˆ‘ç²˜å‡ºæ¥åªæ˜¯ä¸ºäº†æ˜¾å¾—ä¸“ä¸šç‚¹å˜›...</p><p>é‡ç‚¹çœ‹è¿™é‡Œ<strong>ç›‘å¬ç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆæˆ–è§†çª—äº¤å‰çŠ¶æ€çš„æ‰‹æ®µ</strong>ï¼Œå…¶å®å°±æ˜¯è§‚å¯Ÿä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨è§†çª—å¯è§ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/4060631-17210430f2cbf15c.png?imageMogr2/auto-orient/strip|imageView2/2/w/742/format/webp" alt=""></p><p>æ˜¯å¦å¯è§</p><p>å¯ä»¥çœ‹åˆ°ï¼Œäº¤å‰äº†å°±æ˜¯è¯´æ˜å½“å‰å…ƒç´ åœ¨è§†çª—é‡Œï¼Œå½“å‰å°±æ˜¯å¯è§çš„äº†ã€‚</p><h2 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> API</h2><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ„é€ å‡½æ•°ã€‚</p><p>ä»¥ä¸Šä»£ç ä¼šè¿”å›ä¸€ä¸ª<code>IntersectionObserver</code>å®ä¾‹ï¼Œ<code>callback</code>æ˜¯å½“å…ƒç´ çš„å¯è§æ€§å˜åŒ–æ—¶å€™çš„å›è°ƒå‡½æ•°ï¼Œ<code>options</code>æ˜¯ä¸€äº›é…ç½®é¡¹ï¼ˆå¯é€‰ï¼‰ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨è¿”å›çš„è¿™ä¸ªå®ä¾‹æ¥è¿›è¡Œä¸€äº›æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  å¼€å§‹è§‚å¯Ÿï¼Œæ¥å—ä¸€ä¸ª<span class="token constant">DOM</span>èŠ‚ç‚¹å¯¹è±¡
io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>   åœæ­¢è§‚å¯Ÿ æ¥å—ä¸€ä¸ªelementå…ƒç´ 
io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å…³é—­è§‚å¯Ÿå™¨ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="options" tabindex="-1"><a class="header-anchor" href="#options" aria-hidden="true">#</a> options</h3><p>root</p><p>ç”¨äºè§‚å¯Ÿçš„æ ¹å…ƒç´ ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨çš„è§†å£ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“å…ƒç´ ï¼ŒæŒ‡å®šå…ƒç´ çš„æ—¶å€™ç”¨äºè§‚å¯Ÿçš„å…ƒç´ å¿…é¡»æ˜¯æŒ‡å®šå…ƒç´ çš„å­å…ƒç´ </p><p>threshold</p><p>ç”¨æ¥æŒ‡å®šäº¤å‰æ¯”ä¾‹ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™è§¦å‘å›è°ƒå‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé»˜è®¤æ˜¯<code>[0]</code>ã€‚</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    threshold<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;img&#39;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬æŒ‡å®šäº†äº¤å‰æ¯”ä¾‹ä¸º0ï¼Œ0.5ï¼Œ1ï¼Œå½“è§‚å¯Ÿå…ƒç´ img0%ã€50%ã€100%æ—¶å€™å°±ä¼šè§¦å‘å›è°ƒå‡½æ•°</p><p>rootMargin</p><p>ç”¨æ¥æ‰©å¤§æˆ–è€…ç¼©å°è§†çª—çš„çš„å¤§å°ï¼Œä½¿ç”¨cssçš„å®šä¹‰æ–¹æ³•ï¼Œ<code>10px 10px 30px 20px</code>è¡¨ç¤ºtopã€rightã€bottom å’Œ leftçš„å€¼</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;.box&#39;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    threshold<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    rootMargin<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&#39;30px 100px 20px&#39;</span></span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç”»äº†å¼ å›¾ï¼Œå¦‚ä¸‹</p><p><img src="https://upload-images.jianshu.io/upload_images/4060631-ae60b52ea8a52184.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt=""></p><p>options</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹å›¾ä¸Šçš„é—®é¢˜ï¼Œè“çº¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»–å°±æ˜¯å’±ä»¬å®šä¹‰çš„rootå…ƒç´ ï¼Œæˆ‘ä»¬æ·»åŠ äº†<code>rootMargin</code>å±æ€§ï¼Œå°†è§†çª—çš„å¢å¤§äº†ï¼Œè™šçº¿å°±æ˜¯ç°åœ¨çš„è§†çª—ï¼Œæ‰€ä»¥å…ƒç´ ç°åœ¨ä¹Ÿå°±åœ¨è§†çª—é‡Œé¢äº†ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œrootå…ƒç´ åªæœ‰åœ¨<code>rootMargin</code>ä¸ºç©ºçš„æ—¶å€™æ‰æ˜¯ç»å¯¹çš„è§†çª—ã€‚</p><p>è¯´äº†ç®€å•çš„optionsï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹<code>callback</code>ã€‚</p><h3 id="callback" tabindex="-1"><a class="header-anchor" href="#callback" aria-hidden="true">#</a> callback</h3><p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°ï¼Œå½“å…ƒç´ çš„å¯è§æ€§å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘callbackå‡½æ•°ã€‚</p><p>callbackå‡½æ•°ä¼šè§¦å‘ä¸¤æ¬¡ï¼Œå…ƒç´ è¿›å…¥è§†çª—ï¼ˆå¼€å§‹å¯è§æ—¶ï¼‰å’Œå…ƒç´ ç¦»å¼€è§†çª—ï¼ˆå¼€å§‹ä¸å¯è§æ—¶ï¼‰éƒ½ä¼šè§¦å‘</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>$0<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç ï¼Œè¯·åœ¨chromeæ§åˆ¶å°è¿›è¡Œè°ƒè¯•ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†<code>$0</code>é€‰æ‹©äº†ä¸Šä¸€æ¬¡æˆ‘å®¡æŸ¥å…ƒç´ çš„é€‰æ‹©çš„èŠ‚ç‚¹</p><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><p><img src="https://upload-images.jianshu.io/upload_images/4060631-53a2d2fee0ef61ad.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt=""></p><p>è¿è¡Œç»“æœ</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°callbackå‡½æ•°æœ‰ä¸ª<code>entries</code>å‚æ•°ï¼Œå®ƒæ˜¯ä¸ª<code>IntersectionObserverEntry</code>å¯¹è±¡æ•°ç»„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹è¯´ä¸‹IntersectionObserverEntryå¯¹è±¡</p><h3 id="intersectionobserverentry" tabindex="-1"><a class="header-anchor" href="#intersectionobserverentry" aria-hidden="true">#</a> IntersectionObserverEntry</h3><p><code>IntersectionObserverEntry</code>æä¾›è§‚å¯Ÿå…ƒç´ çš„ä¿¡æ¯ï¼Œæœ‰ä¸ƒä¸ªå±æ€§ã€‚</p><blockquote><p>boundingClientRect ç›®æ ‡å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯ intersectionRatio ç›¸äº¤åŒºåŸŸå’Œç›®æ ‡å…ƒç´ çš„æ¯”ä¾‹å€¼ intersectionRect/boundingClientRect ä¸å¯è§æ—¶å°äºç­‰äº0 intersectionRect ç›®æ ‡å…ƒç´ å’Œè§†çª—ï¼ˆæ ¹ï¼‰ç›¸äº¤çš„çŸ©å½¢ä¿¡æ¯ å¯ä»¥ç§°ä¸ºç›¸äº¤åŒºåŸŸ isIntersecting ç›®æ ‡å…ƒç´ å½“å‰æ˜¯å¦å¯è§ Booleanå€¼ å¯è§ä¸ºtrue rootBounds æ ¹å…ƒç´ çš„çŸ©å½¢ä¿¡æ¯ï¼Œæ²¡æœ‰æŒ‡å®šæ ¹å…ƒç´ å°±æ˜¯å½“å‰è§†çª—çš„çŸ©å½¢ä¿¡æ¯ target è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´  time è¿”å›ä¸€ä¸ªè®°å½•ä»<code>IntersectionObserver</code>çš„æ—¶é—´åˆ°äº¤å‰è¢«è§¦å‘çš„æ—¶é—´çš„æ—¶é—´æˆ³</p></blockquote><p>ä¸Šé¢å‡ ä¸ªçŸ©å½¢ä¿¡æ¯çš„å…³ç³»å¦‚ä¸‹</p><p><img src="https://upload-images.jianshu.io/upload_images/4060631-dfe6e9f2e933ae23.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt=""></p><p>å…³ç³».png</p><p>ğŸ‘‡ åˆ’é‡ç‚¹</p><p><strong>intersectionRatio</strong>å’Œ<strong>isIntersecting</strong>æ˜¯ç”¨æ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦å¯è§çš„ï¼ŒæŠ¼é¢˜å’¯...</p><h3 id="æ‡’åŠ è½½" tabindex="-1"><a class="header-anchor" href="#æ‡’åŠ è½½" aria-hidden="true">#</a> æ‡’åŠ è½½</h3><p>å¥½äº†ï¼Œé€šè¿‡ä¸Šé¢ä¸€äº›æ¦‚å¿µæˆ‘ä»¬å¤§æ¦‚äº†è§£äº†<code>IntersectionObserver</code>æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å®ƒæ¥å†™ç‚¹ä»£ç ï¼Œå†™ä»€ä¹ˆå‘¢ï¼Ÿæ²¡é”™å°±æ˜¯æ‡’åŠ è½½ã€‚</p><p>é€šè¿‡IntersectionObserveræ¥å®ç°æ‡’åŠ è½½ï¼Œå°±ç®€å•çš„å¤šäº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®å›è°ƒï¼Œåˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦å¯è§ï¼Œå†è¿›è¡Œæ¸²æŸ“æ“ä½œå°±è¡Œäº†ï¼Œè€Œä¸ç”¨å»å…³å¿ƒå†…éƒ¨çš„è®¡ç®—ã€‚</p><p>ä¸»è¦ä»£ç å¦‚ä¸‹</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// å®ä¾‹åŒ– é»˜è®¤åŸºäºå½“å‰è§†çª—</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>  

<span class="token keyword">let</span> ings <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;[data-src]&#39;</span><span class="token punctuation">)</span> <span class="token comment">// å°†å›¾ç‰‡çš„çœŸå®urlè®¾ç½®ä¸ºdata-src srcå±æ€§ä¸ºå ä½å›¾ å…ƒç´ å¯è§æ—¶å€™æ›¿æ¢src</span>

<span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// éå†entriesæ•°ç»„</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// å½“å‰å…ƒç´ å¯è§</span>
            item<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">=</span> item<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src  <span class="token comment">// æ›¿æ¢src</span>
            io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>target<span class="token punctuation">)</span>  <span class="token comment">// åœæ­¢è§‚å¯Ÿå½“å‰å…ƒç´  é¿å…ä¸å¯è§æ—¶å€™å†æ¬¡è°ƒç”¨callbackå‡½æ•°</span>
        <span class="token punctuation">}</span>   
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token comment">// io.observeæ¥å—ä¸€ä¸ªDOMå…ƒç´ ï¼Œæ·»åŠ å¤šä¸ªç›‘å¬ ä½¿ç”¨forEach</span>
    io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ¬æƒ³å½•åˆ¶ä¸ªGIFå›¾ï¼Œä½¿ç”¨Recordltå§‹ç»ˆä¸Šä¼ ä¸äº†ï¼Œè°æœ‰å¥½ç”¨çš„GIFå›¾å½•åˆ¶è½¯ä»¶è¯·æ¨èä¸ªï¼Œä¸èƒœæ„Ÿæ¿€ã€‚ã€‚</p><p>å‘ï¼Œç»™ä½ èŠ±ğŸŒ¹</p>`,53),u={href:"https://link.jianshu.com?t=https%3A%2F%2Fgithub.com%2FOrtonzhang%2Fsimple-code%2Ftree%2Fmaster%2Fjavascript%2FIntersectionObserver",target:"_blank",rel:"noopener noreferrer"},d=n("h3",{id:"âš ï¸æ³¨æ„",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#âš ï¸æ³¨æ„","aria-hidden":"true"},"#"),s(" âš ï¸æ³¨æ„")],-1),k=n("p",null,"ç›®å‰IntersectionObserveræ˜¯ä¸€ä¸ªå®éªŒä¸­çš„åŠŸèƒ½ï¼Œè¯·é…Œæƒ…ä½¿ç”¨ã€‚",-1),m=n("p",null,[n("img",{src:"https://upload-images.jianshu.io/upload_images/4060631-8637bab61b03c04b.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp",alt:""})],-1),v=n("p",null,"å…¼å®¹æ€§",-1);function b(g,h){const a=t("ExternalLinkIcon");return p(),o("div",null,[r,n("p",null,[s("å› ç¯‡å¹…æœ‰é™ï¼Œå®Œæ•´ä»£ç è¯·æˆ³"),n("a",u,[s("github"),c(a)]),s(" ğŸ˜œ")]),d,k,m,v])}const w=e(l,[["render",b],["__file","IntersectionObserverlanjiazai.html.vue"]]);export{w as default};
